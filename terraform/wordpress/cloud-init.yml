#cloud-config
packages_update: true
packages_upgrade: true
packages:
  - docker

write_files:
  - content: |
      services:
        echo:
          image: mendhak/http-https-echo
          ports:
            - 80:8080
          restart: always
    path: /home/ec2-user/wordpress/docker-compose.yml
    permissions: '0644'
    owner: ec2-user:ec2-user

runcmd:
  - systemctl daemon-reload
  - systemctl enable docker.service
  - systemctl start --no-block docker.service
  - curl -L "https://github.com/docker/compose/releases/download/v2.23.0/docker-compose-linux-x86_64" -o /usr/local/bin/docker-compose
  - chmod +x /usr/local/bin/docker-compose
  - ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
  - usermod -aG docker ec2-user
  - cd /home/ec2-user/wordpress
  - docker-compose up -d





